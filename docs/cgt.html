<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CGT Calculator – Nicolas Moinard</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-1688d9e1630bd0bcb1ec498477fd8fb7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Nicolas Moinard</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./projects.html"> 
<span class="menu-text">Certifications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./cgt.html" aria-current="page"> 
<span class="menu-text">CGT Calculator</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./fbt.html"> 
<span class="menu-text">FBT Calculator</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./benford.html"> 
<span class="menu-text">Benford’s Law Anomaly Detector</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-capital-gains-tax-cgt" id="toc-what-is-capital-gains-tax-cgt" class="nav-link active" data-scroll-target="#what-is-capital-gains-tax-cgt">What is Capital Gains Tax (CGT)?</a></li>
  <li><a href="#cgt-concessions-and-rollover" id="toc-cgt-concessions-and-rollover" class="nav-link" data-scroll-target="#cgt-concessions-and-rollover">CGT Concessions and Rollover</a></li>
  <li><a href="#calculation-of-net-capital-gains" id="toc-calculation-of-net-capital-gains" class="nav-link" data-scroll-target="#calculation-of-net-capital-gains">Calculation of Net Capital Gains</a></li>
  <li><a href="#the-discount-method" id="toc-the-discount-method" class="nav-link" data-scroll-target="#the-discount-method">The Discount Method</a></li>
  <li><a href="#the-indexation-method" id="toc-the-indexation-method" class="nav-link" data-scroll-target="#the-indexation-method">The Indexation Method</a></li>
  <li><a href="#cgt-consequences-of-death" id="toc-cgt-consequences-of-death" class="nav-link" data-scroll-target="#cgt-consequences-of-death">CGT Consequences of Death</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CGT Calculator</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Here is the <a href="https://nicom2000.shinyapps.io/cgt_calculator/">Capital Gains Tax Calculator</a> I made.</p>
<p>Click the link above to launch the live app hosted on <strong>shinyapps.io</strong>.</p>
<hr>
<section id="what-is-capital-gains-tax-cgt" class="level2">
<h2 class="anchored" data-anchor-id="what-is-capital-gains-tax-cgt">What is Capital Gains Tax (CGT)?</h2>
<p>CGT is levied on profit derived from the disposal of a CGT asset acquired <strong><em>on or after 20 September 1985</em></strong>, where the realisation is <u><strong><em>not</em></strong></u> undertaken in the ordinary course of carrying on a business; otherwise, the gain will be assessable under s6-5.</p>
<p>According to s108-5(2), CGT assets encompass: land and buildings (including rental properties), shares in a company, units in a unit trust, rights and options, leases, goodwill, debts owed to a taxpayer, foreign currency, and cryptocurrencies (such as Bitcoin).</p>
<p>The net capital gain derived from the disposal of a CGT asset is considered as statutory income and is included in the taxpayer’s income tax return under Item 18 (s105-5).</p>
<p>However, if an overall net capital loss arises, the amount is not deductible in the income year it occurred. Instead, it is <strong><em>carried forward indefinitely (quarantined) and applied to future capital gains</em></strong>.</p>
<p>A disposal (sale) of an asset that triggers CGT is called a <em>CGT event</em>. Division 104-5 identifies 56 CGT events or ways to dispose of such assets. However, two events occur in 95% of cases:</p>
<ul>
<li><p><strong>A1</strong>: <em>Disposal of a CGT Asset</em><br>
These include the change of legal ownership (sale, transfer, exchange, gift) or destruction of such assets, where timing is usually determined by the date when the contract is signed or the date of settlement in the absence of a contract.</p></li>
<li><p><strong>C1</strong>: <em>Loss or Destruction of a CGT Asset</em><br>
Here, the timing will depend on whether the taxpayer receives compensation in respect to this event.</p>
<ol type="a">
<li>If the CGT asset is insured, a CGT event occurs when the taxpayer first receives compensation/insurance payment.</li>
<li>If the CGT asset is not insured, C1 occurs when the destruction or loss happens or is first discovered. <em>Note: capital losses are calculated as cost base minus capital proceeds, where cost base is at historical cost (not the market value at the time of destruction).</em></li>
</ol></li>
</ul>
<hr>
</section>
<section id="cgt-concessions-and-rollover" class="level1">
<h1>CGT Concessions and Rollover</h1>
<p>Section 118 lists Exempt CGT Assets. Common ones include:</p>
<ul>
<li><p>s118-5(a): a car, motorcycle or similar vehicle designed to carry less than one tonne or fewer than nine passengers.</p></li>
<li><p>s118-10(1): a <strong><em>collectable acquired for a market value of $500 or less</em></strong>, exclusive of GST.<br>
<em>Note: prior carried-forward collectable losses can only be applied against collectable gains<br>
According to s108-10(2), collectables are assets used or kept mainly for the taxpayer’s personal use or enjoyment. They include: artwork, jewellery, an antique, a coin or medallion, a rare portfolio, manuscript or book, a postage stamp or a first-day cover, interest/debt arising/option/right to acquire any of the above assets and antiques (at least 100 years old from the CGT event date).</em></p></li>
<li><p>s118-10(3): a <strong><em>personal-use asset acquired for $10,000 or less</em></strong>, exclusive of GST<br>
<em>Note: personal use capital losses are disregarded/lost. If an asset is both a personal use asset and a collectible, the latter will apply. Includes boats, furniture, electrical goods and household items (including pets).</em></p></li>
<li><p>s118-24: a depreciable asset disposed of after 21 September 1999 under Division 40.<br>
Instead, this will give rise to an assessable balancing adjustment (gain) or a deductible balancing adjustment (loss) under s40-285.<br>
<em>Note: unlike other assets, buildings are subject to the special 2.5% capital works allowance under Div 43, which is not the same as depreciation. Hence, buildings are CGT assets, provided they were acquired post-CGT introduction date.</em></p></li>
<li><p>s118-25: trading stock (inventory) under Division 70</p></li>
<li><p>s118-37(1)(c): gambling winnings or prizes</p></li>
<li><p>subdiv 118-B: an individual’s main residence, usually to the extent that it has not been used for income-producing activities other than rental income, where the main residence is rented for up to six years.</p></li>
</ul>
<p>To avoid double taxation, the anti-overlap provision allows events that are subject to both income tax and CGT to be exempt from the latter. Furthermore, Division 152 provides several CGT reliefs when a small business is being sold.</p>
<p><strong><em>CGT deferrals</em></strong> typically occur when there is a change in the entity owning the CGT asset without a change in the underlying ownership. However, s122-25(2) specifies several assets not subject to rollover relief, such as depreciating assets, trading stock, collectables and personal use assets. Hence, limited situations of rollover exist:</p>
<ul>
<li><p><em>Disposal of an Asset by an Individual or Trustee to a Wholly-Owned Company</em></p></li>
<li><p><em>Disposal of an Asset from a Partnership to a Company</em></p></li>
<li><p><em>Replacement Asset Rollover Events</em></p></li>
<li><p><em>Small Business (&lt;$10M) Restructure Rollover</em></p></li>
</ul>
<hr>
</section>
<section id="calculation-of-net-capital-gains" class="level1">
<h1>Calculation of Net Capital Gains</h1>
<p>In essence, the process goes as follows</p>
<p><em>Current year gross capital gain (held for &gt;12 months)<br>
Current year gross capital gain (held for &lt;12 months)<br>
Less: current year gross capital loss<br>
Less: previous year capital losses carried-forward<br>
Equals: Notional net capital gain<br>
Less: CGT Discount</em></p>
<p>Where Gross Capital Gain = <strong>Capital Proceeds</strong> minus <strong>Cost Base (or Reduced Cost Base)</strong>:</p>
<ul>
<li><p><strong>Capital Proceeds</strong> are the <strong><em>gross</em></strong> amount of consideration as per the sales contract, even if the taxpayer actually received less due to incidental costs. This is because those amounts (e.g.&nbsp;agent’s fees, brokerage…) form part of the cost base. However, 6 modification rules might come into play:<br>
</p>
<ol type="1">
<li>Market Value Substitution (S116-30): if no capital proceeds received (e.g.&nbsp;gift) or partially valued, the proceeds are revalued at market value as parties must be dealing at arm’s length.<br>
</li>
</ol>
<!-- -->
<ol start="2" type="1">
<li><p>Apportionment Rule (S116-40): when proceeds relate to more than one CGT event (e.g.&nbsp;sale of land and building), they must be reasonably apportioned (no need for independent valuation).<br>
</p></li>
<li><p>Non-Receipt Rule (S116-45): proceeds can be reduced by unpaid amounts or bad debts if they exist.<br>
</p></li>
<li><p>Repaid Rule (S116-50): proceeds can be reduced if the taxpayer decides to repay part of those proceeds to the purchaser. Includes giving back property as well.<br>
</p></li>
<li><p>Assumption of Liability Rule (S116-55): sometimes, the purchaser may not directly pay the full amount but will assume the liability of an outstanding amount (e.g.&nbsp;the buyer’s loan) as consideration.</p></li>
<li><p>Misappropriation Rule (S116-60): proceeds may be decreased if the taxpayer’s agent or employee misappropriates (theft, etc.) all or part of the proceeds.</p></li>
</ol></li>
<li><p><strong>Cost Base</strong> is the sum of 5 elements<br>
</p>
<ol type="1">
<li>Acquisition costs: money paid to acquire an asset<br>
</li>
<li>Incidental costs: incurred in acquiring CGT asset + disposing of the asset (stamp duty, legal fees, real estate agent fees…)<br>
</li>
<li>Non-capital ownership costs: additional related expenditures such as interest, repairs and maintenance, council rates, land tax, body corporate and insurance that <strong><em>WERE NOT PREVIOUSLY CLAIMED</em></strong> as a deduction.</li>
</ol>
<ul>
<li>Applies only to non-income-producing assets acquired after 20 August 1991.</li>
<li>Does not qualify for indexation.<br>
</li>
</ul>
<ol start="4" type="1">
<li>Capital Improvement Costs: costs not deductible under 8-1, 25-10 (repairs) and not depreciable under Div 40 (e.g.&nbsp;initial repairs, built-in closet).<br>
</li>
<li>Title Costs (not common): capital expenditure incurred to establish, preserve or defend the title to or right over the asset (legal fees).<br>
</li>
<li>Negative Element or Amounts which Reduce the Cost Base (Div 43)</li>
</ol>
<ul>
<li>For an income-producing property acquired on or after 7:30 pm 13 May 1997, its cost base must be reduced by the accumulated Div 43 claims made since acquisition. If before, no need to reduce. Deduction = 2.5% pa of the original construction cost of the building (=capital work 40-year allowance).</li>
<li>In other words, applies only if: Income-producing CGT building AND acquired on/after 13 May 1997 AND previous Div 43 claimed in taxpayer’s tax return.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="the-discount-method" class="level1">
<h1>The Discount Method</h1>
<p>If a CGT asset is held for <strong>12 months or more</strong>, the Australian Taxation Office (ATO) allows individuals and trusts to discount to 50% the capital gain (proceeds minus cost base) <strong><em>after</em></strong> offsetting any carried forward capital losses.</p>
<p><br>
Super funds are allowed for a 33.33% discount, but companies are <strong><em>not eligible</em></strong>.</p>
<hr>
</section>
<section id="the-indexation-method" class="level1">
<h1>The Indexation Method</h1>
<p>This method is available to <strong><em>all taxpayers</em></strong> if:<br>
1) The asset was held &gt; 12 months; AND<br>
2) Acquisition or costs were incurred between 20 September 1985 and 21 September 1999<br>
<br>
If eligible, a capital gain or loss can be calculated as Capital Proceeds minus <strong>Reduced Cost Base</strong>. <strong><em>Each</em></strong> cost base (<strong><em>excluding Element 3, Ownership Costs</em></strong>) can be inflated by its applicable indexation factor:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 100%">
</colgroup>
<tbody>
<tr class="odd">
<td><span class="math display">\[
Indexation\;Factor\;(3\;decimals)= \frac{CPI_{quarter\ of\ disposal}^{*}}{CPI_{quarter\ of\ acquisition}}
\]</span></td>
</tr>
<tr class="even">
<td><span class="math display">\[
Reduced\ Cost\ Base
= Elements\;1 + 2 + 4 + 5 - Accumulated\ Div\ 43\ Allowance\ Claimed^{**}
\]</span></td>
</tr>
</tbody>
</table>
<p><em>*If disposal is after 21 September 1999, the numerator is frozen at 68.7.</em></p>
<p><em>**Applies regardless of whether the property was acquired before or after 7:30 pm on 13 May 1997.</em></p>
<p>Please visit the ATO’s <a href="https://www.ato.gov.au/tax-rates-and-codes/consumer-price-index">website</a> to consult the applicable CPI rate.</p>
<hr>
</section>
<section id="cgt-consequences-of-death" class="level1">
<h1>CGT Consequences of Death</h1>
<p>Under section 128-15, CGT assets bequeathed in the deceased’s will have CGT consequences for its beneficiaries.</p>
<ul>
<li><p><strong>Deemed Acquisition Date and Value</strong></p>
<ul>
<li><p>Inherited pre-CGT assets: deemed acquired on the date of death at their market value</p></li>
<li><p>Inherited post-CGT assets: deemed acquired on the date that the deceased originally acquired the asset at cost base or reduced cost base</p></li>
<li><p>Beneficiaries will consequently inherit the characteristics of those assets (i.e.&nbsp;collectable, personal use, etc.), but different rules apply regarding the deceased’s main residence</p></li>
</ul></li>
<li><p><strong>Disposal of Inherited CGT Assets</strong></p>
<ul>
<li><p>If an inherited pre-CGT asset is disposed of within 12 months of the date of death, the beneficiary does not benefit from indexation or the 50% discount, as the deemed acquisition date is the date of death.</p></li>
<li><p>If an inherited post-CGT asset is disposed of within 12 months from the date the deceased originally acquired the asset, then the beneficiary does not benefit from indexation and/or discount</p></li>
</ul></li>
</ul>
<hr>
<p>Further details and official requirements are published on the ATO’s <a href="https://www.ato.gov.au/individuals-and-families/investments-and-assets/capital-gains-tax">website</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>